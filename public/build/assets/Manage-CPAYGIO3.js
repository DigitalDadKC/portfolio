import{g as L,u as R,s as j,i as v,c,o as u,a,w as i,d as s,e as _,t as d,b as l,k as g,F as q,r as N,j as W,n as G,m as S,f as B}from"./app-B36-XCD0.js";import{P}from"./PrimaryButton-CEhAluKe.js";import{_ as F}from"./SecondaryButton-BY0miM6g.js";import{u as H}from"./useFormatCurrency-C2nvWDUD.js";import{V as I}from"./VDateInput-DlIuPola.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const J={class:"px-2 py-1 text-center"},X={key:1},Z={class:"text-2xl text-center mt-2 mb-8"},ee={key:0,class:"text-red-400"},te={key:0,class:"text-red-400"},oe={key:0},se={key:1,class:"text-red-400"},ae={key:0,class:"text-red-400"},le={key:0,class:"text-red-400"},re={class:"relative overflow-x-auto bg-light-tertiary dark:bg-dark-tertiary my-4",style:{height:"400px"}},de={class:"w-full text-sm text-left"},ie={scope:"col",class:"px-6 py-3 text-end"},ne={scope:"row",class:"px-6 py-4 font-medium whitespace-nowrap"},ue={class:"px-6 py-4"},ce={class:"px-6 py-4"},pe={class:"px-6 py-4"},me={class:"text-end px-3"},_e={class:"text-end px-3"},ve={key:0,class:"text-red-400"},ye={class:"flex justify-end"},fe={key:0,class:"text-red-400"},ge={class:"flex justify-end"},be={key:0,class:"text-red-400"},ke={class:"flex justify-end gap-2 p-4"},Ce={__name:"Manage",props:{new:Boolean,invoice:Object,customers:Object,materials:Object},setup(M){var h;const{formatWithCommas:x}=H(),n=M,b=L(!1),t=R({id:n.invoice.id,number:n.invoice.number,customer_id:(h=n.invoice.customer)==null?void 0:h.id,date_created:n.invoice.date_created??new Date,due_date:n.invoice.due_date,reference:n.invoice.reference,terms_and_conditions:n.invoice.terms_and_conditions,discount:n.invoice.discount,invoice_items:n.invoice.invoice_items??[]}),y=j(()=>n.customers.find(r=>r.id==t.customer_id)??null),E=()=>{if(t.transform(r=>({...r,date_created:t.date_created?B(t.date_created,"YYYY-MM-DD").value:null,due_date:t.due_date?B(t.due_date,"YYYY-MM-DD").value:null,invoice_items:t.invoice_items.map(e=>({id:e.id,invoice_id:t.id,material_id:e.material.id,quantity:e.quantity,unit_price:e.unit_price}))})),n.new)return t.post(route("invoices.store"),{onSuccess:()=>{b.value=!1,t.reset()}});t.put(route("invoices.update",t.id),{preserveScroll:!0,onSuccess:()=>{b.value=!1}})},T=(r,e)=>{t.invoice_items[e].material=n.materials.find(V=>V.id===r.material.id)},w=j(()=>t.invoice_items.reduce((r,e)=>r+e.unit_price*e.quantity,0)),z=()=>{t.invoice_items.push({material:{id:null,sku:"",name:""},unit_price:0,quantity:1})};return(r,e)=>{const V=v("v-icon"),k=v("v-text-field"),f=v("v-col"),U=v("v-select"),$=v("v-row"),O=v("v-textarea"),A=v("v-container"),Q=v("v-dialog");return u(),c("div",J,[a(Q,{modelValue:b.value,"onUpdate:modelValue":e[10]||(e[10]=o=>b.value=o),"max-width":"1000","max-height":"1000",scrollable:""},{activator:i(({props:o})=>[n.new?(u(),W(P,G(S({key:0},o)),{default:i(()=>e[11]||(e[11]=[g("Add Invoice",-1)])),_:2,__:[11]},1040)):(u(),c("div",X,[a(V,S({size:"x-small"},o),{default:i(()=>e[12]||(e[12]=[g("mdi-pencil",-1)])),_:2,__:[12]},1040)]))]),default:i(()=>[a(A,{class:"bg-light-primary dark:bg-dark-primary text-black rounded-lg"},{default:i(()=>[s("div",Z,d(`${n.new?"New Invoice":`Edit Invoice #${n.invoice.number}`}`),1),a($,{dense:"",class:"bg-light-secondary dark:bg-dark-secondary p-4"},{default:i(()=>[a(f,{cols:"3"},{default:i(()=>[a(k,{density:"compact",label:"Number",modelValue:l(t).number,"onUpdate:modelValue":e[0]||(e[0]=o=>l(t).number=o),class:"bg-light-tertiary dark:bg-dark-tertiary","hide-details":""},null,8,["modelValue"]),r.$page.props.errors.number?(u(),c("div",ee,d(r.$page.props.errors.number),1)):_("",!0)]),_:1}),a(f,{cols:"12",md:"3"},{default:i(()=>[a(k,{density:"compact",label:"Reference",modelValue:l(t).reference,"onUpdate:modelValue":e[1]||(e[1]=o=>l(t).reference=o),class:"bg-light-tertiary dark:bg-dark-tertiary","hide-details":""},null,8,["modelValue"]),r.$page.props.errors.reference?(u(),c("div",te,d(r.$page.props.errors.reference),1)):_("",!0)]),_:1}),a(f,{cols:"12",md:"6"},{default:i(()=>{var o,m,p,C,D,Y;return[a(U,{density:"compact",modelValue:l(t).customer_id,"onUpdate:modelValue":e[2]||(e[2]=K=>l(t).customer_id=K),items:n.customers,label:"Customer","item-title":"name","item-value":"id",class:"bg-light-tertiary dark:bg-dark-tertiary","auto-select-first":"",clearable:"","hide-details":""},null,8,["modelValue","items"]),y.value?(u(),c("div",oe,[s("p",null,d((o=y.value)==null?void 0:o.address),1),s("p",null,d((m=y.value)==null?void 0:m.city)+" "+d((p=y.value)==null?void 0:p.state.abbr)+", "+d((C=y.value)==null?void 0:C.zip),1),s("p",null,"Email: "+d((D=y.value)==null?void 0:D.email),1),s("p",null,"Phone: "+d((Y=y.value)==null?void 0:Y.phone),1)])):_("",!0),r.$page.props.errors.customer_id?(u(),c("div",se,d(r.$page.props.errors.customer_id),1)):_("",!0)]}),_:1}),a(f,{cols:"12",md:"3"},{default:i(()=>[a(l(I),{modelValue:l(t).date_created,"onUpdate:modelValue":e[3]||(e[3]=o=>l(t).date_created=o),density:"compact",label:"Date Created",class:"bg-light-tertiary dark:bg-dark-tertiary","hide-details":""},null,8,["modelValue"]),r.$page.props.errors.date_created?(u(),c("div",ae,d(r.$page.props.errors.date_created),1)):_("",!0)]),_:1}),a(f,{cols:"12",md:"3"},{default:i(()=>[a(l(I),{modelValue:l(t).due_date,"onUpdate:modelValue":e[4]||(e[4]=o=>l(t).due_date=o),density:"compact",label:"Due Date",class:"bg-light-tertiary dark:bg-dark-tertiary","hide-details":""},null,8,["modelValue"]),r.$page.props.errors.due_date?(u(),c("div",le,d(r.$page.props.errors.due_date),1)):_("",!0)]),_:1})]),_:1}),s("div",re,[s("table",de,[s("thead",null,[s("tr",null,[e[14]||(e[14]=s("th",{scope:"col",class:"px-6 py-3"},"SKU",-1)),e[15]||(e[15]=s("th",{scope:"col",class:"px-6 py-3"},"Description",-1)),e[16]||(e[16]=s("th",{scope:"col",class:"px-6 py-3"},"Price",-1)),e[17]||(e[17]=s("th",{scope:"col",class:"px-6 py-3"},"Quantity",-1)),e[18]||(e[18]=s("th",{scope:"col",class:"px-6 py-3"},"Total",-1)),s("th",ie,[a(F,{onClick:e[5]||(e[5]=o=>z())},{default:i(()=>e[13]||(e[13]=[g("Add",-1)])),_:1,__:[13]})])])]),s("tbody",null,[(u(!0),c(q,null,N(l(t).invoice_items,(o,m)=>(u(),c("tr",{class:"bg-light-secondary dark:bg-dark-secondary border-b dark:border-gray-700 border-gray-200",key:m},[s("td",ne,[s("p",null,d(o.material.sku),1)]),s("td",ue,[a(U,{modelValue:o.material.id,"onUpdate:modelValue":[p=>o.material.id=p,p=>T(o,m)],density:"compact",label:"Name",items:n.materials,"item-value":"id","item-title":"name","hide-details":""},null,8,["modelValue","onUpdate:modelValue","items"])]),s("td",ce,[a(k,{modelValue:o.unit_price,"onUpdate:modelValue":p=>o.unit_price=p,density:"compact",label:"Price",prefix:"$","hide-details":""},null,8,["modelValue","onUpdate:modelValue"])]),s("td",pe,[a(k,{modelValue:o.quantity,"onUpdate:modelValue":p=>o.quantity=p,density:"compact",label:"Quantity","hide-details":""},null,8,["modelValue","onUpdate:modelValue"])]),s("td",me,[s("p",null,d(l(x)(o.unit_price*o.quantity,"currency")),1)]),s("td",_e,[a(V,{class:"cursor-pointer",onClick:p=>l(t).invoice_items.splice(m,1)},{default:i(()=>e[19]||(e[19]=[g("mdi-close",-1)])),_:2,__:[19]},1032,["onClick"])])]))),128))])])]),l(t).errors?(u(),c("div",ve,[(u(!0),c(q,null,N(l(t).errors,(o,m)=>(u(),c("p",{key:m},d(m)+": "+d(o),1))),128))])):_("",!0),s("div",ye,[s("p",null,"Subtotal: "+d(l(x)(w.value,"currency")),1)]),a($,null,{default:i(()=>[a(f,{cols:"12",md:"2",offset:"10",class:"flex"},{default:i(()=>[a(k,{density:"compact",label:"Discount",modelValue:l(t).discount,"onUpdate:modelValue":e[6]||(e[6]=o=>l(t).discount=o),suffix:"%",class:"bg-light-tertiary dark:bg-dark-tertiary text-end",width:"140","hide-details":""},null,8,["modelValue"]),r.$page.props.errors.discount?(u(),c("div",fe,d(r.$page.props.errors.discount),1)):_("",!0)]),_:1})]),_:1}),s("div",ge,[s("p",null,"Total: "+d(l(x)(w.value*(1-l(t).discount/100),"currency")),1)]),a($,null,{default:i(()=>[a(f,{cols:"12",class:"overflow-y-auto"},{default:i(()=>[e[20]||(e[20]=s("div",{class:"text-xl font-bold text-center uppercase"},"Terms & Conditions",-1)),a(O,{modelValue:l(t).terms_and_conditions,"onUpdate:modelValue":e[7]||(e[7]=o=>l(t).terms_and_conditions=o),density:"compact",rows:"6",class:"overflow-y-auto bg-light-tertiary dark:bg-dark-tertiary","hide-details":""},null,8,["modelValue"]),r.$page.props.errors.terms_and_conditions?(u(),c("div",be,d(r.$page.props.errors.terms_and_conditions),1)):_("",!0)]),_:1,__:[20]})]),_:1}),s("div",ke,[a(F,{onClick:e[8]||(e[8]=o=>{b.value=!1,l(t).reset(),l(t).clearErrors()})},{default:i(()=>e[21]||(e[21]=[g("Cancel",-1)])),_:1,__:[21]}),a(P,{onClick:e[9]||(e[9]=o=>{r.loading=!r.loading,E()})},{default:i(()=>e[22]||(e[22]=[g("Save",-1)])),_:1,__:[22]})])]),_:1})]),_:1},8,["modelValue"])])}}};export{Ce as default};
