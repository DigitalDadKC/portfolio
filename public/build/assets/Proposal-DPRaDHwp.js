import{u as R,s as Q,v as X,l as I,i as _,J as ee,j as z,o as f,w as d,a as l,b as o,h as le,k as y,t as v,d as c,x as j,c as $,F as te,r as oe,B as E,e as C,K as ae,p as se,q as k}from"./app-B36-XCD0.js";import{_ as re}from"./EstimatingLayout-D_4DmskC.js";import{P as M}from"./PrimaryButton-CEhAluKe.js";import{D as de}from"./DangerButton-aoGgiAsu.js";import{d as ne}from"./vuedraggable.umd-CuITSMz5.js";import{V as ie}from"./VDateInput-DlIuPola.js";import"./NavLink-BrQt31dZ.js";import"./GuestLayout-C970xYKx.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";function ue(U){return{fillQuantity:(b,i)=>{U.proposal.scopes[b].lines[i].quantity=U.proposal.scopes[b].area},totals:()=>{U.proposal.scopes.map(b=>b.lines.map(i=>i.total=(i.price*i.quantity*100/100).toLocaleString())),U.proposal.scopes.map(b=>b.total=b.lines.map(i=>i.price*i.quantity*100/100).reduce((i,w)=>i+w,0).toLocaleString()),U.proposal.total=U.proposal.scopes.map(b=>b.lines.map(i=>i.price*i.quantity*100/100).reduce((i,w)=>i+w,0)).reduce((b,i)=>b+i,0).toLocaleString()}}}const pe={class:"flex items-start justify-end mb-4"},me={class:"flex justify-between py-1"},ce={size:"48",class:"text-lg"},be={class:"flex flex-col md:flex-row gap-1 w-min"},ye={key:0,class:"text-red-400"},ge={class:"flex justify-end"},_e={class:"bg-grey-darken-1 rounded-md"},fe={class:"flex items-start p-1 text-lg cursor-pointer"},ve={class:"rounded-md bg-grey-darken-4 float-right"},Ve={class:"hidden md:flex md:flex-row items-center py-1"},ke={key:0,class:"text-red-500"},Ue={key:1,class:"text-red-500"},he={key:2,class:"text-red-500"},Se={key:3,class:"text-red-500"},$e={class:"flex justify-end mt-2"},je={class:"flex justify-end my-2"},Be={class:"flex justify-between mt-2"},Le={__name:"Proposal",props:{new:Boolean,proposal:Object,company:Object,states:Object,types:Object,unit_of_measurements:Object,errors:Object},setup(U){const g=U,t=R({proposal:g.proposal,PDF:!0});let{fillQuantity:b,totals:i}=ue(t);const w=Q(()=>[{id:null,state:"Select"},...g.states]),O=Q(()=>[{id:null,UOM:"Select"},...g.unit_of_measurements]);X(()=>{i()});const P=()=>{k.put(route("proposals.update",t.proposal.id),{name:t.proposal.name,type:t.proposal.type,exclusions:t.proposal.exclusions},{preserveScroll:!0,onSuccess:()=>{i()}})},J=()=>{k.delete(route("proposals.destroy",t.proposal.id))},K=()=>{k.post(route("scopes.create",t.proposal.id),{},{preserveScroll:!0,onSuccess:()=>{i()}})},x=p=>{let e=t.proposal.scopes[p];k.put(route("scopes.update",e.id),{name:e.name,area:e.area},{preserveScroll:!0,onSuccess:()=>{i()}})},W=p=>{k.delete(route("scopes.destroy",p),{preserveScroll:!0,onSuccess:()=>{i()}})},L=p=>{let e=t.proposal.scopes[p].id;k.post(route("lines.create",e),{},{preserveScroll:!0,onSuccess:()=>{i()}})},h=(p,e)=>{let V=t.proposal.scopes[p].lines[e];k.put(route("lines.update",V.id),{description:V.description,unit_of_measurement_id:V.unit_of_measurement.id,price:V.price,quantity:V.quantity},{preserveScroll:!0,onSuccess:()=>{i()}})},T=(p,e)=>{let V=t.proposal.scopes[p].lines[e].id;k.delete(route("lines.destroy",V),{preserveScroll:!0,onSuccess:()=>{i()}})},Y=p=>{k.patch(route("lines.sort",p.id),{lines:p.lines},{preserveScroll:!0,onSuccess:()=>{i()}})};return I(()=>g.proposal,p=>{t.proposal=g.proposal}),(p,e)=>{const V=_("v-img"),Z=_("v-card-title"),N=_("v-card-subtitle"),G=_("v-card"),S=_("v-col"),m=_("v-text-field"),q=_("v-select"),D=_("v-row"),A=_("v-textarea"),B=_("v-icon"),H=_("v-container"),F=ee("motion-slide-right");return f(),z(re,null,{default:d(()=>[l(o(le),{title:"Estimating Web App"}),l(H,{class:"w-100 w-xl-75 bg-light-secondary rounded-lg"},{default:d(()=>[l(D,{"no-gutters":""},{default:d(()=>[l(S,{cols:"12",md:"5"},{default:d(()=>[l(V,{src:"/img/logo.png",class:"rounded-lg mb-2","aria-label":"company logo"}),l(G,null,{default:d(()=>[l(Z,null,{default:d(()=>[y(v(g.company.name),1)]),_:1}),l(N,null,{default:d(()=>[y(v(g.company.address),1)]),_:1}),l(N,null,{default:d(()=>[y(v(g.company.city)+" "+v(g.company.state.abbr)+", "+v(g.company.zip),1)]),_:1})]),_:1})]),_:1}),l(S,{cols:"12",md:"6","offset-md":"1",class:"flex flex-col bg-light-tertiary rounded-lg"},{default:d(()=>[l(m,{modelValue:o(t).proposal.job.number,"onUpdate:modelValue":e[0]||(e[0]=a=>o(t).proposal.job.number=a),modelModifiers:{number:!0},type:"number",disabled:!0,prefix:`D${new Date(o(t).proposal.job.created_at).getFullYear()} - `,"hide-details":"",density:"compact",label:"Job Number *",class:"bg-grey-lighten-4"},null,8,["modelValue","prefix"]),l(m,{modelValue:o(t).proposal.job.address,"onUpdate:modelValue":e[1]||(e[1]=a=>o(t).proposal.job.address=a),"hide-details":"",disabled:!0,density:"compact",label:"Address *",class:"bg-grey-lighten-4"},null,8,["modelValue"]),l(D,{"no-gutters":""},{default:d(()=>[l(S,{cols:"12",lg:"6"},{default:d(()=>[l(m,{modelValue:o(t).proposal.job.city,"onUpdate:modelValue":e[2]||(e[2]=a=>o(t).proposal.job.city=a),"hide-details":"",disabled:!0,density:"compact",label:"City *",class:"bg-grey-lighten-4"},null,8,["modelValue"])]),_:1}),l(S,{cols:"12",lg:"3"},{default:d(()=>[l(q,{modelValue:o(t).proposal.job.state.id,"onUpdate:modelValue":e[3]||(e[3]=a=>o(t).proposal.job.state.id=a),"hide-details":"",disabled:!0,items:w.value,"item-title":"state","item-value":"id",label:"State *",density:"compact",class:"bg-grey-lighten-4"},null,8,["modelValue","items"])]),_:1}),l(S,{cols:"12",lg:"3"},{default:d(()=>[l(m,{modelValue:o(t).proposal.job.zip,"onUpdate:modelValue":e[4]||(e[4]=a=>o(t).proposal.job.zip=a),"hide-details":"",label:"Zip Code *",disabled:!0,density:"compact",class:"bg-grey-lighten-4"},null,8,["modelValue"])]),_:1})]),_:1}),l(o(ie),{modelValue:o(t).proposal.job.start_date,"onUpdate:modelValue":e[5]||(e[5]=a=>o(t).proposal.job.start_date=a),disabled:!0,label:"Start Date",density:"compact","hide-details":"",class:"bg-grey-lighten-4"},null,8,["modelValue"]),l(A,{modelValue:o(t).proposal.job.notes,"onUpdate:modelValue":e[6]||(e[6]=a=>o(t).proposal.job.notes=a),disabled:!0,"hide-details":"",label:"Notes",class:"bg-grey-lighten-4"},null,8,["modelValue"])]),_:1})]),_:1}),l(D,null,{default:d(()=>[l(S,{cols:"12",md:"9"},{default:d(()=>[l(m,{modelValue:o(t).proposal.name,"onUpdate:modelValue":e[7]||(e[7]=a=>o(t).proposal.name=a),variant:"solo",label:"Proposal Title",class:"text-light-quatrenary","hide-details":"",onBlur:e[8]||(e[8]=a=>P())},null,8,["modelValue"])]),_:1}),l(S,null,{default:d(()=>[l(q,{modelValue:o(t).proposal.type,"onUpdate:modelValue":[e[9]||(e[9]=a=>o(t).proposal.type=a),e[10]||(e[10]=a=>P())],items:g.types,label:"Proposal Type","hide-details":""},null,8,["modelValue","items"])]),_:1})]),_:1}),l(D,null,{default:d(()=>[l(S,null,{default:d(()=>[c("form",{onSubmit:e[14]||(e[14]=j(a=>p.submit(),["prevent"])),class:"p-4 rounded-md"},[c("div",pe,[l(M,{class:"h-12 w-32 text-center text-large",onClick:e[11]||(e[11]=j(a=>K(),["prevent"]))},{default:d(()=>e[18]||(e[18]=[y("Add Scope",-1)])),_:1,__:[18]})]),(f(!0),$(te,null,oe(o(t).proposal.scopes,(a,n)=>E((f(),$("div",{key:n,class:"bg-light-primary rounded-md p-4 flex flex-col mb-4"},[c("div",me,[c("h1",ce,"Scope # "+v(n+1),1),l(M,{onClick:j(r=>W(a.id),["prevent"])},{default:d(()=>[l(B,null,{default:d(()=>e[19]||(e[19]=[y("mdi-trash-can",-1)])),_:1,__:[19]})]),_:2},1032,["onClick"])]),c("div",be,[l(m,{modelValue:a.name,"onUpdate:modelValue":r=>a.name=r,label:"Scope Name","hide-details":"",density:"compact",placeholder:"Name",class:"bg-grey-darken-1 md:w-96 text-black",onBlur:r=>x(n)},null,8,["modelValue","onUpdate:modelValue","onBlur"]),l(m,{modelValue:a.area,"onUpdate:modelValue":r=>a.area=r,modelModifiers:{number:!0},label:"Area","hide-details":"",density:"compact",placeholder:"Area",class:"bg-grey-darken-1 md:w-60 text-black",type:"number",onBlur:r=>x(n)},null,8,["modelValue","onUpdate:modelValue","onBlur"])]),o(t).errors["scopes."+n+".name"]?(f(),$("div",ye,v(o(t).errors["scopes."+n+".name"]),1)):C("",!0),c("div",ge,[l(M,{class:"w-28",onClick:j(r=>L(n),["prevent"])},{default:d(()=>e[20]||(e[20]=[y("Add Line",-1)])),_:2,__:[20]},1032,["onClick"])]),c("div",_e,[l(o(ne),{list:a.lines,"item-key":"id",handle:".handle",onChange:r=>Y(a)},{item:d(({element:r,index:u})=>[E((f(),$("div",null,[c("details",{class:"bg-grey open:bg-grey-lighten-2 duration-500 rounded-md block md:hidden",onKeyup:e[12]||(e[12]=ae(s=>{s.preventDefault()},["space"]))},[c("summary",fe,[l(B,{size:"28",class:"handle cursor-pointer rounded-lg bg-light-tertiary dark:bg-dark-tertiary"},{default:d(()=>e[21]||(e[21]=[y("mdi mdi-drag-horizontal-variant",-1)])),_:1,__:[21]}),l(m,{modelValue:r.description,"onUpdate:modelValue":s=>r.description=s,"hide-details":"",density:"compact",label:"Description *",class:"",onBlur:s=>h(n,u)},null,8,["modelValue","onUpdate:modelValue","onBlur"]),c("button",ve,[u?(f(),z(B,{key:1,size:"28",class:"bg-grey-darken-4",onClick:j(s=>T(n,u),["prevent"])},{default:d(()=>e[23]||(e[23]=[y("mdi-minus",-1)])),_:2,__:[23]},1032,["onClick"])):(f(),z(B,{key:0,size:"28",class:"bg-grey-darken-4",onClick:j(s=>L(n),["prevent"])},{default:d(()=>e[22]||(e[22]=[y("mdi-plus-box",-1)])),_:2,__:[22]},1032,["onClick"]))])]),c("div",null,[l(q,{modelValue:r.unit_of_measurement.id,"onUpdate:modelValue":s=>r.unit_of_measurement.id=s,"hide-details":"",items:O.value,density:"compact",label:"UOM *",class:"bg-grey text-grey-darken-4","item-title":"UOM","item-value":"id",onBlur:s=>h(n,u)},null,8,["modelValue","onUpdate:modelValue","items","onBlur"]),l(m,{modelValue:r.price,"onUpdate:modelValue":s=>r.price=s,modelModifiers:{number:!0},"hide-details":"",type:"number",density:"compact",label:"Price *",prefix:"$",class:"bg-grey text-grey-darken-4",onBlur:s=>h(n,u),onInput:s=>p.lineTotal(n,u)},null,8,["modelValue","onUpdate:modelValue","onBlur","onInput"]),l(m,{modelValue:r.quantity,"onUpdate:modelValue":s=>r.quantity=s,modelModifiers:{number:!0},"hide-details":"",type:"number",density:"compact",label:"Quantity *",class:"bg-grey text-grey-darken-4",onBlur:s=>h(n,u),onInput:s=>p.lineTotal(n,u)},null,8,["modelValue","onUpdate:modelValue","onBlur","onInput"]),l(m,{modelValue:r.total,"onUpdate:modelValue":s=>r.total=s,"hide-details":"",density:"compact",label:"Line Total",disabled:"",class:"bg-grey text-grey-darken-4 text-black"},null,8,["modelValue","onUpdate:modelValue"])])],32),c("div",Ve,[l(B,{size:"48",class:"handle cursor-pointer bg-light-tertiary dark:bg-dark-tertiary rounded-md mx-1"},{default:d(()=>e[24]||(e[24]=[y("mdi mdi-drag-horizontal-variant",-1)])),_:1,__:[24]}),l(m,{modelValue:r.description,"onUpdate:modelValue":s=>r.description=s,"hide-details":"",density:"compact",label:"Description *",class:"w-1/3",onBlur:s=>h(n,u)},null,8,["modelValue","onUpdate:modelValue","onBlur"]),l(q,{modelValue:r.unit_of_measurement.id,"onUpdate:modelValue":[s=>r.unit_of_measurement.id=s,s=>h(n,u)],"hide-details":"",items:O.value,density:"compact",label:"UOM *",class:"w-20","item-title":"UOM","item-value":"id"},null,8,["modelValue","onUpdate:modelValue","items"]),l(m,{modelValue:r.price,"onUpdate:modelValue":s=>r.price=s,modelModifiers:{number:!0},"hide-details":"",type:"number",density:"compact",label:"Price *",prefix:"$",class:"w-20",onBlur:s=>h(n,u)},null,8,["modelValue","onUpdate:modelValue","onBlur"]),l(m,{modelValue:r.quantity,"onUpdate:modelValue":s=>r.quantity=s,modelModifiers:{number:!0},"hide-details":"",type:"number",density:"compact","prepend-inner-icon":"mdi-checkbox-marked",label:"Quantity *",class:"w-20","onClick:prependInner":s=>o(b)(n,u),onBlur:s=>h(n,u)},null,8,["modelValue","onUpdate:modelValue","onClick:prependInner","onBlur"]),l(m,{modelValue:r.total,"onUpdate:modelValue":s=>r.total=s,density:"compact",label:"Total",prefix:"$","hide-details":"",readonly:""},null,8,["modelValue","onUpdate:modelValue"]),l(B,{size:"40",class:"bg-light-quatrenary text-light-secondary rounded-lg ml-2",onClick:j(s=>T(n,u),["prevent"])},{default:d(()=>e[25]||(e[25]=[y("mdi-minus",-1)])),_:2,__:[25]},1032,["onClick"])]),o(t).errors["proposal.scopes."+n+".lines."+u+".description"]?(f(),$("div",ke,v(o(t).errors["proposal.scopes."+n+".lines."+u+".description"]),1)):C("",!0),o(t).errors["proposal.scopes."+n+".lines."+u+".price"]?(f(),$("div",Ue,v(o(t).errors["proposal.scopes."+n+".lines."+u+".price"]),1)):C("",!0),o(t).errors["proposal.scopes."+n+".lines."+u+".quantity"]?(f(),$("div",he,v(o(t).errors["proposal.scopes."+n+".lines."+u+".quantity"]),1)):C("",!0),o(t).errors["proposal.scopes."+n+".lines."+u+".unit_of_measurement.id"]?(f(),$("div",Se,v(o(t).errors["proposal.scopes."+n+".lines."+u+".unit_of_measurement.id"]),1)):C("",!0)])),[[F]])]),_:2},1032,["list","onChange"])]),c("div",$e,[l(m,{modelValue:a.total,"onUpdate:modelValue":r=>a.total=r,"hide-details":"",density:"compact",label:"Scope Total",prefix:"$",disabled:"",class:"bg-grey max-w-48 text-black"},null,8,["modelValue","onUpdate:modelValue"])])])),[[F]])),128)),c("div",je,[l(m,{modelValue:o(t).proposal.total,"onUpdate:modelValue":e[13]||(e[13]=a=>o(t).proposal.total=a),density:"compact",label:"Job Total",prefix:"$",class:"bg-grey text-black max-w-48","hide-details":"",disabled:""},null,8,["modelValue"])])],32),c("div",null,[l(A,{modelValue:o(t).proposal.exclusions,"onUpdate:modelValue":e[15]||(e[15]=a=>o(t).proposal.exclusions=a),"hide-details":"",label:"Exclusions",class:"bg-light-tertiary dark:bg-dark-tertiary rounded-lg",onBlur:e[16]||(e[16]=a=>P())},null,8,["modelValue"])]),c("div",Be,[l(o(se),{href:p.route("estimating.index"),as:"button",prefetch:""},{default:d(()=>[l(M,{type:"button"},{default:d(()=>e[26]||(e[26]=[y("Back",-1)])),_:1,__:[26]})]),_:1},8,["href"]),l(de,{color:"red-accent-2",onClick:e[17]||(e[17]=a=>J())},{default:d(()=>e[27]||(e[27]=[y("Delete Proposal",-1)])),_:1,__:[27]})])]),_:1})]),_:1})]),_:1})]),_:1})}}};export{Le as default};
